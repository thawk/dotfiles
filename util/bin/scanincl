#!/usr/bin/env bash
# Time: 2020-04-17 08:45:33

DEST_FILE=compile_flags.txt

if [[ -f "${DEST_FILE}" ]]
then
    # remove all include rules generated by myself (-I./*)
    sed -i -e '/^ *-I\.\//d' "${DEST_FILE}"
else
    > "${DEST_FILE}" echo "-std=c++11"
    >> "${DEST_FILE}" echo "-xc++"
fi

find . -type d -name include |
    grep -v "/unittest/\|/test/\|/examples\?/" |
    grep -v "/boost_[0-9]\+_[0-9_]\+/" |
    sed -n -e '/^[^ ]/{s#^#-I#;p;}' \
    >> "${DEST_FILE}"
